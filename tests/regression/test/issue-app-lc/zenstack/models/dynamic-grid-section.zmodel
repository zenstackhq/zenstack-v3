import '../shared/timestamps'
import '../types/dynamic-grid-section-category.type'
import './instance'

model DynamicGridSection with Timestamps {
  id             String                     @id @default(cuid())

  /// Name
  name           String

  /// Description
  description    String?

  /// Icon
  icon           String

  /// Category
  category       DynamicGridSectionCategory @json

  /// Building blocks
  /// [IDynamicGridItem]
  buildingBlocks Json[]

  // Relations
  // Instance ID
  instanceId     String

  /// Instance
  instance       Instance?                  @relation(fields: [instanceId], references: [id])

  @@allow(
    'read',
    instance.ownerId == auth().id // Allow the owner
    // Allow users with "dynamicGridSection:manage" or "all:read" claims
    || (
      instance.users?[accountId == auth().id
      && roles?[claims?[id == "dynamicGridSection:manage" || id == "all:read"]]]
    )
  )

  @@allow(
    'create,update,delete',
    instance.ownerId == auth().id // Allow the owner
    // Allow users with "dynamicGridSection:manage" or "all:manage" claims
    || (
      instance.users?[accountId == auth().id
      && roles?[claims?[id == "dynamicGridSection:manage" || id == "all:manage"]]]
    )
  )
}
