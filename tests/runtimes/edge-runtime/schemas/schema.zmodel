datasource db {
    provider = "postgresql"
}

plugin policy {
    provider = "../../../packages/plugins/policy"
}

model User {
    id    String  @id @default(cuid())
    email String  @unique
    name  String?
    posts Post[]

    // Access policies
    @@allow('all', auth().id == id)
    @@allow('read', auth() != null)
}

model Post {
    id        String  @id @default(cuid())
    title     String
    published Boolean @default(false)
    author    User    @relation(fields: [authorId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    authorId  String

    // Access policies
    @@deny('all', auth() == null)
    @@allow('all', auth().id == authorId)
    @@allow('read', published)
}
